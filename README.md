## ReverseCRC

Finding polynomial, init and xor values of CRC.


### Algorithms

Repository contains followint implementations of CRC:
* _DivisionCRC_ - standard shift register implementation,
* _HwCRC_ - implementation popular in hardware (according to Wikipedia),
* _ModCRC_ - implementation compatible with _crcmod_ library.

_DivisionCRC_ and _HwCRC_ have its backward versions which allows to find polynomials from input messages.


### Running

For run parameters execute `src/find.sh --help`

Running computation: `src/find.sh --file in.txt --outfile results.txt --mode BF_PAIRS --algo MOD`

Example of *in.txt* file:
```#comment
0020FCFF 11
0120FCFF 8C
0220FCFF 36
```
where first hex number in row is data and second number is calculated CRC.

#### Parameters

- *infile*: input file
- *mode*: operation mode:
    - *BF*: finding full key by forward algorithm (brute force)
    - *BF_PAIRS*: finding full key by forward algorithm using pair xoring (brute force)
    - *POLY*: find polynomials by xor-ing data pairs
    - *COMMON*: check common keys used in industry
- *alg*: decode algorithm:
    - *HW* -- use *HwCRC*
    - *DIV* -- use *DivisionCRC*
    - *MOD* -- use *ModCRC*
- *mindsize*: Data size in frame, rest of frame will be treated as potential CRC field

#### C bindings

Application comes with fast version of algorithms, that is implemented in C. 
To use it it's needed to compile proper algorithms and then build Python bindings.

Building algorithms is done by executing `./src/fastcrc/clib/build.sh`

Using *ctypes* bindings does not require additional steps. In order to use *cffi* one has to execute `./src/fastcrc/cffi/build.py`. 
*Swig* binding can be prepared by calling `./src/fastcrc/swig/build.sh`.


There is no more extra steps required to use prepared binding. It will be detected automatically in runtime. 
There is also possiblitity to enforce use of certain binding. It can be done by setting `FASTCRC_BINDING` env variable to one of following values:
- `auto` -- automatically select one of available bindings
- `ctypes` -- use *ctypes*
- `cffi` -- use *cffi*
- `swig` -- use *swig*

For testing, following oneliner might be very handy: `FASTCRC_BINDING=cffi ./src/find.sh --mode BF --alg HW ...`

Note that, at the memoent, fast CRC is only implemented for *HW* algorithm.


### Development

Following techniques were used in the project:
* Unit testing 
* Code profiling (cProfile)
* Code coverage (Coverage.py)


#### Profiler

To run main application it needs to run one of following commands:
* *find.sh {params} --profile*
* *find.sh {params} --pfile={output file}*

In first case output will be displayed on stdout. In second case output will be stored inside *{output file}*. 

Tests can be run with profiler by one of following commands:
* *test_runner.py {params} --profile*
* *test_runner.py {params} --pfile={output file}*


#### Code coverage

Executing application with code coverage can be done by following call: *find.sh {params} --coverage*.

After the call _htmlcov_ directory will be created inside run directory.

Running code coverage on tests is done by *test_runner.py*.

Call command: *test_runner.py --coverage*.

As a result *htmlcov* directory will be created inside run directory.


### Various techniques

- *fastcrc* uses lookup tables to speed-up calculation
- lookup tables are automatically generated by additional scripts executed by CMake on demand (*add_custom_command*)
- *ctypes* Python module is used for binding C *fastcrc* library to speed-up CRC computation


### References

* https://en.wikipedia.org/wiki/Cyclic_redundancy_check - general description of CRC algorithm,
* https://en.wikipedia.org/wiki/Computation_of_cyclic_redundancy_checks - general description of CRC algorithm,
* http://www.sunshine2k.de/articles/coding/crc/understanding_crc.html - description of CRC algorithm,
* http://www.infradead.org/~mchehab/kernel_docs/unsorted/crc32.html - opimised shift register algorithm,
* http://www.cosc.canterbury.ac.nz/greg.ewing/essays/CRC-Reverse-Engineering.html - reverse engineering of CRC.
* binding C/C++ in Python -- https://realpython.com/python-bindings-overview/
